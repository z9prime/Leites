<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>ACESSO RESTRITO: COFRE</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <nav>
        <a href="index.html">PAINEL OPERAÃ‡Ã•ES</a>
        <a href="cofre.html" class="active">O COFRE</a>
    </nav>

    <div class="container vault-container">
        <div class="big-lock">ðŸ”’</div>
        <h2>FUNDO DE CONTRA-ATAQUE (VILÃƒO)</h2>
        
        <div class="vault-amount" id="bigVaultDisplay">
            CARREGANDO...
        </div>

        <p style="opacity: 0.6; max-width: 600px; margin: 0 auto;">
            Este fundo Ã© intocÃ¡vel. Representa 20% de todos os lucros obtidos nas operaÃ§Ãµes de arbitragem contra o sistema.
            <br><br>
            OBJETIVO: <span style="color: var(--primary)">FALÃŠNCIA DO ALVO</span>
        </p>

        <div style="margin-top: 50px; border-top: 1px solid #333; padding-top: 20px;">
            <h3>CONTRIBUIÃ‡Ã•ES RECENTES AO COFRE</h3>
            <ul id="vaultLogs" style="list-style: none; padding: 0; color: var(--primary);">
                </ul>
        </div>
    </div>

    <script>
        // --- CONFIGURAÃ‡ÃƒO SUPABASE ---
        // Substitui aqui pelas tuas chaves REAIS do projeto Supabase
        const supabaseUrl = 'AQUI_A_TUA_URL_SUPABASE'; 
        const supabaseKey = 'AQUI_A_TUA_CHAVE_ANON_PUBLIC';

        // CORREÃ‡ÃƒO AQUI: MudÃ¡mos o nome para 'supabaseClient'
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        async function loadVault() {
            // Usamos 'supabaseClient' em vez de 'supabase'
            const { data, error } = await supabaseClient
                .from('historico_operacoes')
                .select('valor_para_cofre, data_operacao')
                .order('data_operacao', { ascending: false });

            if (error) {
                console.error("Erro ao carregar o cofre:", error);
                document.getElementById('bigVaultDisplay').innerText = "ERRO CONEXÃƒO";
                return;
            }

            let total = 0;
            const list = document.getElementById('vaultLogs');

            if (data) {
                data.forEach(op => {
                    total += parseFloat(op.valor_para_cofre);
                    
                    // Mostrar apenas os Ãºltimos 5 logs na lista
                    if (list.children.length < 5) {
                        const li = document.createElement('li');
                        // FormataÃ§Ã£o da data para PT-PT
                        const dataFormatada = new Date(op.data_operacao).toLocaleDateString('pt-PT');
                        li.innerHTML = `+ â‚¬ ${parseFloat(op.valor_para_cofre).toFixed(2)} <small>(${dataFormatada})</small>`;
                        list.appendChild(li);
                    }
                });
            }
            // Atualiza o valor grande no centro
            document.getElementById('bigVaultDisplay').innerText = `â‚¬ ${total.toFixed(2)}`;
        }

        // Inicia a funÃ§Ã£o ao carregar a pÃ¡gina
        loadVault();
    </script>
</body>
</html>